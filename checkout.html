<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex,nofollow">
    <meta name="description" content="Secure checkout at Brandly.">
    <title>Checkout - Brandly</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="manifest" href="site.webmanifest">
    <script src="js/seo.js"></script>
</head>
<body>
    <header class="navbar">
        <div class="navbar-container">
            <a href="index.html" class="navbar-logo">Brandly</a>
            <nav class="navbar-menu" aria-label="Primary">
                <a href="products.html" class="nav-link">Shop</a>
                <a href="about.html" class="nav-link">About</a>
                <a href="contact.html" class="nav-link">Contact</a>
            </nav>
            <button class="mobile-menu-button" aria-label="Open menu" aria-controls="mobile-drawer" aria-expanded="false">
                <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" focusable="false">
                    <path fill="currentColor" d="M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h18v2H3v-2z"/>
                </svg>
            </button>
            <a href="cart.html" class="cart-icon">
                <span class="cart-icon-text">ðŸ›’</span>
                <span class="cart-counter" aria-label="Items in cart">0</span>
            </a>
        </div>
    </header>

    <div class="drawer-overlay" data-overlay hidden></div>
    <aside id="mobile-drawer" class="mobile-drawer" aria-hidden="true" aria-label="Mobile navigation">
        <div class="mobile-drawer-header">
            <span class="drawer-title">Menu</span>
            <button class="drawer-close" aria-label="Close menu">
                <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" focusable="false">
                    <path fill="currentColor" d="M18.3 5.71 12 12l6.3 6.29-1.41 1.41L10.59 13.4 4.29 19.7 2.88 18.3 9.17 12 2.88 5.71 4.29 4.3l6.3 6.3 6.29-6.3z"/>
                </svg>
            </button>
        </div>
        <nav class="mobile-drawer-nav" aria-label="Mobile Primary">
            <a href="products.html" class="drawer-link">Shop</a>
            <a href="about.html" class="drawer-link">About</a>
            <a href="contact.html" class="drawer-link">Contact</a>
        </nav>
    </aside>
    <main>
        <section class="checkout-section">
            <h1>Checkout</h1>

			<div class="checkout-container">
				<form id="checkout-form" class="checkout-form">
                    <fieldset>
                        <legend>Shipping Information</legend>
                        
                        <div class="form-group">
                            <label for="fullname">Full Name *</label>
                            <input type="text" id="fullname" name="fullname" required>
                        </div>

                        <div class="form-group">
                            <label for="email">Email *</label>
                            <input type="email" id="email" name="email" required>
                        </div>

                        <div class="form-group">
                            <label for="phone">Phone Number *</label>
                            <input type="tel" id="phone" name="phone" required>
                        </div>

                        <div class="form-group">
                            <label for="address1">Address Line 1 *</label>
                            <input type="text" id="address1" name="address1" required>
                        </div>

                        <div class="form-group">
                            <label for="city">City *</label>
                            <input type="text" id="city" name="city" required>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="state">State/Province *</label>
                                <input type="text" id="state" name="state" required>
                            </div>
                            <div class="form-group">
                                <label for="postal">Postal Code *</label>
                                <input type="text" id="postal" name="postal" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="country">Country *</label>
                            <input type="text" id="country" name="country" required>
                        </div>

                        <div class="form-group">
                            <label for="notes">Shipping Notes</label>
                            <textarea id="notes" name="notes" rows="3" placeholder="Any special delivery instructions..."></textarea>
                        </div>
                    </fieldset>

					<!-- Paystack is the only supported payment method. -->

                    <div class="checkout-actions">
                        <button type="submit" class="btn btn-primary btn-large">Complete Order</button>
                        <a href="products.html" class="btn btn-secondary btn-large">Continue Shopping</a>
                    </div>
                </form>
				<aside class="checkout-summary" aria-label="Order Summary">
					<h3>Order Summary</h3>
					<div id="order-items">
						<!-- Populated by JS -->
					</div>
					<div class="summary-total">
						<strong>Total: â‚¦<span id="total-price">0.00</span></strong>
					</div>
				</aside>
            </div>
        </section>

    </main>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <p>&copy; 2025 Brandly. All rights reserved.</p>
            </div>
            <nav class="footer-section" aria-label="Footer">
                <a href="privacy.html">Privacy Policy</a>
                <a href="terms.html">Terms & Conditions</a>
                <a href="refund.html">Return & Refund Policy</a>
            </nav>
            <div class="footer-section">
                <p>Follow us:</p>
                <div class="social-links">
                    <a href="#" class="social-link" aria-label="TikTok" title="TikTok">
                        <svg viewBox="0 0 24 24" aria-hidden="true">
                            <path fill="currentColor" d="M13 2h3.2c.3 1.2 1 2.4 2 3.2A6.9 6.9 0 0021 6.5V9c-1.8 0-3.5-.5-5-1.4v6.2A6.8 6.8 0 019.2 21 6.7 6.7 0 013 14.3 6.7 6.7 0 019.7 7.6c.4 0 .9 0 1.3.1V11a3.8 3.8 0 00-1.3-.2A3.3 3.3 0 006.4 14.2a3.3 3.3 0 003.3 3.3c1.8 0 3.3-1.5 3.3-3.3V2z"/>
                        </svg>
                    </a>
                    <a href="#" class="social-link" aria-label="Instagram" title="Instagram">
                        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M7 2h10a5 5 0 015 5v10a5 5 0 01-5 5H7a5 5 0 01-5-5V7a5 5 0 015-5zm5 5a5 5 0 100 10 5 5 0 000-10zm6-1a1 1 0 110 2 1 1 0 010-2z" fill="currentColor"/></svg>
                    </a>
                    <a href="#" class="social-link" aria-label="Facebook" title="Facebook">
                        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M22 12c0-5.522-4.477-10-10-10S2 6.478 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.988H7.898v-2.89h2.54V9.797c0-2.507 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.261c-1.243 0-1.631.771-1.631 1.562v1.875h2.773l-.443 2.89h-2.33V21.88C18.343 21.128 22 16.991 22 12z" fill="currentColor"/></svg>
                    </a>
                </div>
            </div>
        </div>
    </footer>

	<script src="js/main.js"></script>
	<script src="js/products.js"></script>
	<script src="js/cart.js"></script>
	<script src="https://js.paystack.co/v1/inline.js"></script>
    <script>
		// Configure your Paystack public key (Test or Live)
		const PAYSTACK_PUBLIC_KEY = 'pk_test_132e17cd46e7aed3802ce0b41d51a1ceb61d1efc'

        document.addEventListener('DOMContentLoaded', function() {
            const cart = getCart();
            const orderItems = document.getElementById('order-items');
            let total = 0;

            cart.forEach(item => {
                const product = products.find(p => p.id === item.id);
                if (product) {
                    const itemTotal = product.price * item.quantity;
                    total += itemTotal;
                    orderItems.innerHTML += `
                        <div class="order-item">
                            <span>${product.name} x ${item.quantity}</span>
                            <span>â‚¦${itemTotal.toFixed(2)}</span>
                        </div>
                    `;
                }
            });

            document.getElementById('total-price').textContent = total.toFixed(2);

            document.getElementById('checkout-form').addEventListener('submit', function(e) {
                e.preventDefault();
				const form = this;

				// Ensure cart has items
				if (!cart || cart.length === 0) {
					alert('Your cart is empty.');
					return;
				}

				// Collect required customer data
				const email = document.getElementById('email').value;
				const fullname = document.getElementById('fullname').value;
				const phone = document.getElementById('phone').value;
				const address1 = document.getElementById('address1').value;
				const city = document.getElementById('city').value;
				const state = document.getElementById('state').value;
				const postal = document.getElementById('postal').value;
				const country = document.getElementById('country').value;
				const notes = document.getElementById('notes').value;
				if (!email || !fullname) {
					alert('Please fill your name and email.');
					return;
				}

				const [firstName, ...restParts] = fullname.trim().split(' ');
				const lastName = restParts.join(' ') || '';
				const orderSummary = cart.map(item => {
					const product = products.find(p => p.id === item.id);
					if (!product) return `Item ${item.id} x ${item.quantity}`;
					const itemTotal = (product.price * item.quantity).toFixed(2);
					return `${product.name} x ${item.quantity} = â‚¦${itemTotal}`;
				}).join('; ');
				const addressLine = [address1, city, state, postal, country].filter(Boolean).join(', ');

				// Initialize Paystack popup
				const handler = PaystackPop.setup({
					key: PAYSTACK_PUBLIC_KEY,
					email: email,
					amount: Math.round(total * 100), // amount in kobo
					currency: 'NGN',
					ref: 'BRANDLY_' + Date.now(),
					metadata: {
						fullname: fullname,
						firstname: firstName,
						lastname: lastName,
						phone: phone,
						email: email,
						notes: notes,
						address: {
							address1: address1,
							city: city,
							state: state,
							postal: postal,
							country: country
						},
						cart: cart.map(i => {
							const product = products.find(p => p.id === i.id);
							return {
								id: i.id,
								name: product ? product.name : `Item ${i.id}`,
								price: product ? product.price : undefined,
								quantity: i.quantity,
								line_total: product ? +(product.price * i.quantity).toFixed(2) : undefined
							};
						}),
						total: +total.toFixed(2),
						custom_fields: [
							{
								display_name: 'Customer Name',
								variable_name: 'customer_name',
								value: fullname
							},
							{
								display_name: 'Phone',
								variable_name: 'phone',
								value: phone
							},
							{
								display_name: 'Address',
								variable_name: 'address',
								value: addressLine
							},
							{
								display_name: 'Order Items',
								variable_name: 'order_items',
								value: orderSummary
							},
							{
								display_name: 'Order Total (NGN)',
								variable_name: 'order_total',
								value: `â‚¦${total.toFixed(2)}`
							}
						]
					},
					callback: function(response) {
						// Payment successful: clear cart and redirect to success page with reference
						try {
							clearCart();
							updateCartCounter();
						} catch (e) {}
						window.location.href = `success.html?ref=${encodeURIComponent(response.reference)}`;
					},
					onClose: function() {
						// User closed payment window
					}
				});
				handler.openIframe();
            });
        });
    </script>
</body>
</html>
